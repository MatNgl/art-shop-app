@use "sass:string";

/* ==========================================================================
   Profile – Glassmorphism premium (LIGHT ONLY)
   Aligne le rendu sur profile-layout : verre, reflets, ombres, transitions.
   Variables attendues globalement : --accent, --accent-50/100/700, --border, --card
   Ce fichier force une encre sombre lisible (pas de dark mode).
   ========================================================================== */

:host {
  /* Encre et texte (contraste fort sur fond clair/pastel) */
  --ink: #0f172a;   /* slate-900 like */
  --muted: #475569; /* slate-600 like */

  /* Verre plus présent pour fond très clair/pastel */
  --glass-bg: rgba(255,255,255,.18);
  --glass-border: rgba(255,255,255,.45);
  --glass-blur: 16px;

  /* Ombres cohérentes profil (douces, multipliées) */
  --shadow-near: 0 2px 8px rgba(17,24,39,.10);
  --shadow-ambient: 0 14px 48px rgba(17,24,39,.18);
  --shadow-hover-near: 0 6px 18px rgba(17,24,39,.12);
  --shadow-hover-ambient: 0 22px 64px rgba(17,24,39,.24);

  --trs: 260ms cubic-bezier(.22,.61,.36,1);
}

/* ============================ Mixins utilitaires ========================= */
@mixin glass-card($radius: 1rem, $blur: var(--glass-blur)) {
  position: relative;
  background: var(--glass-bg);
  backdrop-filter: blur($blur);
  -webkit-backdrop-filter: blur($blur);
  border: 1px solid var(--glass-border);
  border-radius: $radius;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.50), /* halo interne un peu plus marqué */
    var(--shadow-near),
    var(--shadow-ambient);
  transition:
    background-color var(--trs),
    border-color var(--trs),
    box-shadow var(--trs),
    transform var(--trs),
    backdrop-filter var(--trs), -webkit-backdrop-filter var(--trs);
  isolation: isolate;

  &::before {
    /* Reflet supérieur + micro contre-ombre pour le relief */
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.60),
      inset 0 -1px 0 rgba(17,24,39,.06);
    pointer-events: none;
  }
}

@mixin elevate-hover($dy: -1px) {
  transform: translateY($dy);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.55),
    var(--shadow-hover-near),
    var(--shadow-hover-ambient);
}

@mixin focus-ring($accent: var(--accent)) {
  outline: none;
  box-shadow:
    0 0 0 1px color-mix(in srgb, #ffffff 70%, transparent),
    0 0 0 4px color-mix(in srgb, $accent 30%, transparent),
    var(--shadow-near),
    var(--shadow-ambient);
  border-color: color-mix(in srgb, $accent 32%, var(--glass-border));
}

/* ============================ Panneaux / Sections ======================== */
:host form.bg-white,
:host .logged-out-card,
:host .card-glass {
  padding: 1.5rem;
  /* léger tint d'accent en haut pour lier au layout */
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 10%, transparent) 0%, transparent 72%),
    var(--glass-bg);
  color: var(--ink);
  @include glass-card(1rem);

  &:hover {
    @include elevate-hover(-1px);
  }
}

:host .section-header {
  @include glass-card(1rem);
  padding: 1rem 1.25rem;
  margin-bottom: 1.5rem;
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 12%, transparent) 0%, transparent 100%),
    var(--glass-bg);
}
:host .section-title   { font-size: 1.5rem; font-weight: 800; color: var(--ink); }
:host .section-subtitle{ color: color-mix(in srgb, var(--muted) 88%, var(--ink)); }

/* ================================ Inputs ================================= */
:host label,
:host .form-label { color: color-mix(in srgb, var(--ink) 92%, #000); }

:host .input {
  width: 100%;
  border-radius: .75rem;
  border: 1px solid color-mix(in srgb, var(--border) 70%, transparent);
  background: rgba(255,255,255,.62); /* +lisible sur fond clair */
  color: var(--ink);
  padding: .625rem .75rem;
  transition: border-color var(--trs), box-shadow var(--trs), background-color var(--trs);

  &::placeholder {
    color: color-mix(in srgb, var(--muted) 82%, var(--ink)) !important;
    opacity: 1;
  }

  &:hover {
    background: rgba(255,255,255,.70);
    border-color: color-mix(in srgb, var(--accent) 18%, var(--border));
  }
  &:focus,
  &:focus-visible {
    @include focus-ring();
    background: rgba(255,255,255,.76);
  }
  &.invalid {
    border-color: color-mix(in srgb, crimson 55%, var(--border));
  }
}

/* Feedback champs */
:host .field-status {
  margin-top: .25rem; font-size: .875rem;
  display: flex; align-items: center; gap: .5rem; color: var(--ink);
}
:host .field-status--error { color: color-mix(in srgb, crimson 78%, #000); }
:host .field-status--ok    { color: color-mix(in srgb, seagreen 78%, #000); }

:host .sr-only {
  position: absolute; width: 1px; height: 1px; padding: 0; margin: -1px;
  overflow: hidden; clip: rect(0,0,0,0); white-space: nowrap; border: 0;
}

/* ================================ Boutons ================================ */
:host .btn {
  display: inline-flex; align-items: center; justify-content: center;
  gap: .5rem;
  padding: .625rem 1rem;
  font-weight: 600; font-size: .875rem;
  border-radius: .75rem;
  border: 1px solid color-mix(in srgb, var(--border) 60%, transparent);
  transition: transform var(--trs), box-shadow var(--trs), border-color var(--trs), background-color var(--trs);
  will-change: transform;
  color: var(--ink);
  i { margin-right: .25rem; }
  &:disabled {
    opacity: .6; cursor: not-allowed;
    color: color-mix(in srgb, var(--muted) 70%, var(--ink));
  }
}

:host .btn--primary {
  @include glass-card(.75rem);
  color: #fff; /* CTA principal = texte blanc pour contraste sur accent */
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 22%, transparent) 0%, transparent 100%),
    rgba(255,255,255,.12);
  border-color: color-mix(in srgb, var(--accent) 42%, var(--glass-border));
  &:hover { @include elevate-hover(-1px); }
  &:focus-visible { @include focus-ring(); }
  &:active { transform: translateY(0); box-shadow: var(--shadow-near), var(--shadow-ambient); }
}

:host .btn--secondary {
  @include glass-card(.75rem);
  background: rgba(255,255,255,.12);
  color: var(--ink);
  &:hover {
    @include elevate-hover(-1px);
    border-color: color-mix(in srgb, var(--accent) 20%, var(--glass-border));
  }
  &:focus-visible { @include focus-ring(); }
}

/* Badge succès (verre vert pastel) */
:host .success-badge {
  @include glass-card(999px);
  display: inline-flex; align-items: center;
  padding: .5rem 1rem; font-size: .875rem; font-weight: 600;
  color: color-mix(in srgb, #064e3b 80%, #000);
  background:
    linear-gradient(180deg, color-mix(in srgb, #10b981 16%, transparent), transparent),
    rgba(255,255,255,.12);
  border-color: color-mix(in srgb, #10b981 40%, var(--glass-border));
}

/* =============================== Actions grid =========================== */
:host .actions-grid {
  display: grid; gap: 1rem;
  grid-template-columns: repeat(1, minmax(0, 1fr));
}
@media (min-width: 640px) { :host .actions-grid { grid-template-columns: repeat(2, minmax(0, 1fr)); } }
@media (min-width: 1024px){ :host .actions-grid { grid-template-columns: repeat(3, minmax(0, 1fr)); } }

/* =============================== Action cards =========================== */
:host .action-card {
  @include glass-card(1rem, 18px); /* blur ↑ pour effacer le fond chargé */
  padding: 1.25rem; border-width: 1px; cursor: pointer; overflow: hidden;
  display: flex; align-items: center; gap: 1rem;
  background:
    radial-gradient(120% 120% at 0% 0%, color-mix(in srgb, var(--accent) 8%, transparent) 0%, transparent 55%),
    var(--glass-bg);
  color: var(--ink);

  &:hover { @include elevate-hover(-1px); }
  &:active { transform: translateY(0); }
  &:focus-visible { @include focus-ring(); }

  .action-card__icon {
    @include glass-card(.75rem);
    background: rgba(255,255,255,.18);
    width: 3rem; height: 3rem; display: grid; place-items: center;
    font-size: 1.25rem; flex-shrink: 0;
    transition: transform var(--trs), filter var(--trs);
    color: color-mix(in srgb, var(--ink) 86%, #000);
  }
  &:hover .action-card__icon { transform: translateY(-1px) scale(1.06); }

  .action-card__content { flex: 1 1 0%; min-width: 0; }
  .action-card__title   { font-weight: 700; color: var(--ink); margin-bottom: .25rem; }
  .action-card__desc    { font-size: .875rem; color: color-mix(in srgb, var(--muted) 90%, var(--ink)); }

  .action-card__arrow   { color: color-mix(in srgb, var(--muted) 80%, var(--ink)); transition: transform var(--trs); flex-shrink: 0; }
  &:hover .action-card__arrow { transform: translateX(4px); }
}

/* Variantes pastel (décoratives, texte toujours sombre) */
$variants: (
  "blue":   #2563eb,
  "green":  #10b981,
  "purple": #7c3aed,
  "pink":   #ec4899,
  "orange": #f59e0b,
  "red":    #ef4444
);

@each $name, $color in $variants {
  $class: string.unquote($name);

  :host .action-card--#{$class} {
    background:
      radial-gradient(120% 120% at 0% 0%, color-mix(in srgb, #{$color} 10%, transparent) 0%, transparent 55%),
      var(--glass-bg);
    border-color: color-mix(in srgb, #{$color} 22%, var(--glass-border));

    .action-card__icon {
      background:
        linear-gradient(180deg, color-mix(in srgb, #{$color} 16%, transparent), transparent),
        rgba(255,255,255,.16);
      color: color-mix(in srgb, var(--ink) 86%, #000);
    }

    .action-card__title { color: var(--ink); }
    .action-card__desc  { color: color-mix(in srgb, var(--muted) 90%, var(--ink)); }

    &:hover {
      border-color: color-mix(in srgb, #{$color} 34%, var(--glass-border));
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.55),
        var(--shadow-hover-near),
        0 28px 72px color-mix(in srgb, #{$color} 18%, rgba(17,24,39,.22));
    }

    &:focus-visible {
      box-shadow:
        0 0 0 4px color-mix(in srgb, #{$color} 28%, #ffffff),
        var(--shadow-near),
        var(--shadow-ambient);
    }
  }
}

/* ============================ Utilitaires / Divers ======================= */
:host .muted,
:host .text-muted { color: color-mix(in srgb, var(--muted) 90%, var(--ink)); }

:host .divider,
:host hr { border-color: color-mix(in srgb, var(--muted) 24%, #fff); }

/* ============================ Responsive / Motion ======================== */
@media (max-width: 640px) {
  :host .action-card { padding: 1rem; }
  :host .action-card__icon { width: 2.5rem; height: 2.5rem; font-size: 1.125rem; }
}
@media (prefers-reduced-motion: reduce) {
  :host * { transition: none !important; animation: none !important; }
}
