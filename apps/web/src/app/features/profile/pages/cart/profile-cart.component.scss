@use "sass:string";

/* ==========================================================================
   Cart – Glassmorphism premium (LIGHT ONLY, aligné sur Profile)
   Variables attendues globalement : --accent, --accent-50/100/700, --border
   Ce module force une encre sombre lisible sur fond clair/pastel.
   ========================================================================== */

:host {
  --ink: #0f172a;      /* slate-900 like */
  --muted: #475569;    /* slate-600 like */

  /* Verre renforcé pour plus de flou premium */
  --glass-bg: rgba(255,255,255,.18);
  --glass-border: rgba(255,255,255,.45);
  --glass-blur: 28px;              /* augmenté */
  --glass-blur-card: 32px;         /* flou maximal pour cartes items */
  --glass-blur-summary: 32px;      /* flou maximal pour résumé */
  --glass-blur-empty: 28px;        /* flou pour empty state */
  --glass-blur-qty: 20px;          /* flou pour contrôles quantité */

  /* Ombres (cohérence Profile) */
  --shadow-near: 0 2px 8px rgba(17,24,39,.10);
  --shadow-ambient: 0 14px 48px rgba(17,24,39,.18);
  --shadow-hover-near: 0 6px 18px rgba(17,24,39,.12);
  --shadow-hover-ambient: 0 22px 64px rgba(17,24,39,.24);

  --trs: 260ms cubic-bezier(.22,.61,.36,1);
}

/* ============================ Mixins utilitaires ========================= */
@mixin glass-card($radius: 1rem, $blur: var(--glass-blur)) {
  position: relative;
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 8%, transparent) 0%, transparent 80%),
    var(--glass-bg);
  backdrop-filter: blur($blur);
  -webkit-backdrop-filter: blur($blur);
  border: 1px solid var(--glass-border);
  border-radius: $radius;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.50),
    var(--shadow-near),
    var(--shadow-ambient);
  transition:
    background-color var(--trs),
    border-color var(--trs),
    box-shadow var(--trs),
    transform var(--trs),
    backdrop-filter var(--trs), -webkit-backdrop-filter var(--trs);
  isolation: isolate;

  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.60),
      inset 0 -1px 0 rgba(17,24,39,.06);
    pointer-events: none;
  }
}

@mixin elevate-hover($dy: -1px) {
  transform: translateY($dy);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.55),
    var(--shadow-hover-near),
    var(--shadow-hover-ambient);
}

@mixin focus-ring($accent: var(--accent)) {
  outline: none;
  box-shadow:
    0 0 0 1px color-mix(in srgb, #ffffff 70%, transparent),
    0 0 0 4px color-mix(in srgb, $accent 30%, transparent),
    var(--shadow-near),
    var(--shadow-ambient);
  border-color: color-mix(in srgb, $accent 32%, var(--glass-border));
}

/* ================================ Page Layout ============================ */
::ng-deep .max-w-5xl {
  animation: pageIn .35s ease both;
}

@keyframes pageIn {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}

::ng-deep h1 {
  font-size: 1.25rem; font-weight: 800; letter-spacing: .2px;
  color: var(--ink);
  text-shadow:
    0 1px 0 rgba(255,255,255,.85),
    0 0 1px rgba(255,255,255,.6);
}

/* ============================= Empty State Card ========================== */
::ng-deep .bg-white.rounded-xl.p-8 {
  @include glass-card(1rem, var(--glass-blur-empty));
  padding: 2rem;
  color: var(--ink);
  will-change: transform, box-shadow;

  p {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
    margin-bottom: 1rem;
  }

  a {
    @include glass-card(.75rem, 16px);
    display: inline-flex;
    align-items: center;
    padding: .625rem 1rem;
    font-weight: 700;
    color: #fff;
    background:
      linear-gradient(180deg, color-mix(in srgb, var(--accent) 22%, transparent) 0%, transparent 100%),
      rgba(255,255,255,.10);
    border-color: color-mix(in srgb, var(--accent) 42%, var(--glass-border));
    transition: all var(--trs);

    &:hover {
      @include elevate-hover(-1px);
    }
  }
}

/* ============================== Cart Items =============================== */
::ng-deep .bg-white.rounded-lg.border.p-3 {
  @include glass-card(.875rem, var(--glass-blur-card));
  padding: .75rem;
  color: var(--ink);
  will-change: transform, box-shadow;

  &:hover {
    @include elevate-hover(-1px);
  }

  img {
    border-radius: .5rem;
    box-shadow:
      0 1px 4px rgba(17,24,39,.10),
      inset 0 1px 0 rgba(255,255,255,.4);
    border: 1px solid rgba(255,255,255,.3);
  }

  .font-semibold {
    color: var(--ink);
    font-weight: 700;
    text-shadow: 0 1px 0 rgba(255,255,255,.55);
  }

  .text-xs {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
  }

  /* Taille de texte custom 11px */
  :where([class*="text-[11px]"]) {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
  }

  button[aria-label="Supprimer l'article"] {
    @include glass-card(.5rem, 14px);
    background:
      linear-gradient(180deg, color-mix(in srgb, #ef4444 10%, transparent), transparent),
      rgba(255,255,255,.18);
    color: color-mix(in srgb, #dc2626 85%, #000);
    border-color: color-mix(in srgb, #ef4444 32%, var(--glass-border));
    padding: .25rem .5rem;
    font-size: .75rem;
    font-weight: 600;
    transition: all var(--trs);

    &:hover {
      background:
        linear-gradient(180deg, color-mix(in srgb, #ef4444 16%, transparent), transparent),
        rgba(255,255,255,.24);
      transform: translateY(-1px);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.6),
        0 2px 6px rgba(239,68,68,.15);
    }
  }
}

/* ============================= Quantity Controls ========================= */
::ng-deep .inline-flex.items-center.rounded-full.border {
  @include glass-card(999px, var(--glass-blur-qty));
  background: rgba(255,255,255,.22);
  border-color: color-mix(in srgb, var(--border) 65%, transparent);
  padding: 0;
  overflow: hidden;
  will-change: transform;

  button {
    background: transparent;
    border: none;
    color: var(--ink);
    font-weight: 700;
    transition: background-color var(--trs), color var(--trs);

    &:hover:not(:disabled) {
      background: rgba(255,255,255,.35);
      color: var(--accent);
    }

    &:disabled {
      opacity: .4;
      cursor: not-allowed;
    }

    &:focus-visible {
      @include focus-ring();
      z-index: 1;
    }
  }

  span {
    color: var(--ink);
    font-weight: 700;
    text-shadow: 0 1px 0 rgba(255,255,255,.55);
  }
}

/* ============================== Summary Aside ============================ */
::ng-deep aside.bg-white.rounded-lg.border {
  @include glass-card(1rem, var(--glass-blur-summary));
  padding: 1.25rem;
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 10%, transparent) 0%, transparent 100%),
    var(--glass-bg);
  color: var(--ink);
  will-change: transform, box-shadow;

  h2 {
    font-size: 1.125rem;
    font-weight: 800;
    color: var(--ink);
    text-shadow: 0 1px 0 rgba(255,255,255,.6);
    margin-bottom: .75rem;
  }

  dl {
    dt {
      color: color-mix(in srgb, var(--muted) 88%, var(--ink));
    }

    dd {
      color: var(--ink);
      font-weight: 600;
    }

    .font-semibold {
      color: var(--ink);
      font-weight: 700;
      text-shadow: 0 1px 0 rgba(255,255,255,.55);
    }

    .border-t {
      border-color: color-mix(in srgb, var(--muted) 24%, #fff);
      padding-top: .5rem;
    }
  }

  p {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
    font-size: .75rem;
    line-height: 1.4;
  }

  /* CTA principal - Passer commande */
  a.bg-blue-600 {
    @include glass-card(.75rem, 16px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: .625rem 1rem;
    font-weight: 700;
    color: #fff;
    background:
      linear-gradient(180deg, color-mix(in srgb, var(--accent) 22%, transparent) 0%, transparent 100%),
      rgba(255,255,255,.10);
    border-color: color-mix(in srgb, var(--accent) 42%, var(--glass-border));
    margin-top: 1rem;
    transition: all var(--trs);

    &:hover:not(.opacity-50) {
      @include elevate-hover(-1px);
    }

    &.opacity-50 {
      opacity: .5;
      cursor: not-allowed;
    }

    &:focus-visible {
      @include focus-ring();
    }
  }

  /* Bouton Vider le panier */
  button.bg-gray-100 {
    @include glass-card(.75rem, 14px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: .625rem 1rem;
    font-weight: 600;
    background:
      linear-gradient(180deg, color-mix(in srgb, #6b7280 8%, transparent), transparent),
      rgba(255,255,255,.18);
    color: color-mix(in srgb, var(--ink) 90%, #000);
    border-color: color-mix(in srgb, var(--border) 65%, transparent);
    margin-top: .5rem;
    transition: all var(--trs);

    &:hover {
      background:
        linear-gradient(180deg, color-mix(in srgb, #6b7280 12%, transparent), transparent),
        rgba(255,255,255,.24);
      transform: translateY(-1px);
    }

    &:focus-visible {
      @include focus-ring();
    }
  }

  /* Bouton Continuer mes achats */
  a.bg-white.border {
    @include glass-card(.75rem, 14px);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 100%;
    padding: .625rem 1rem;
    font-weight: 600;
    background: rgba(255,255,255,.18);
    color: var(--ink);
    border-color: color-mix(in srgb, var(--border) 65%, transparent);
    margin-top: .5rem;
    transition: all var(--trs);

    &:hover {
      background: rgba(255,255,255,.28);
      border-color: color-mix(in srgb, var(--accent) 20%, var(--glass-border));
      transform: translateY(-1px);
    }

    &:focus-visible {
      @include focus-ring();
    }
  }
}

/* ============================== Responsive =============================== */
@media (prefers-reduced-motion: reduce) {
  :host * { transition: none !important; animation: none !important; }
}

/* =============== Fallback si backdrop-filter indisponible ================ */
@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
  ::ng-deep .bg-white.rounded-xl,
  ::ng-deep .bg-white.rounded-lg,
  ::ng-deep aside.bg-white {
    background: rgba(255,255,255,.82);
  }
}
