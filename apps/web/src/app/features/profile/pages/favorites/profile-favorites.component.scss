@use "sass:string";

/* ==========================================================================
   Favorites – Glassmorphism premium (LIGHT ONLY, aligné sur Profile)
   Variables attendues globalement : --accent, --accent-50/100/700, --border
   Ce module force une encre sombre lisible sur fond clair/pastel.
   ========================================================================== */

:host {
  --ink: #0f172a;      /* slate-900 like */
  --muted: #475569;    /* slate-600 like */

  /* Verre renforcé pour plus de flou */
  --glass-bg: rgba(255,255,255,.18);
  --glass-border: rgba(255,255,255,.45);
  --glass-blur: 28px;           /* augmenté */
  --glass-blur-card: 32px;      /* flou fort pour les cartes produits */
  --glass-blur-skeleton: 26px;  /* flou pour skeleton loader */
  --glass-blur-empty: 28px;     /* flou pour empty state */

  /* Ombres (cohérence Profile) */
  --shadow-near: 0 2px 8px rgba(17,24,39,.10);
  --shadow-ambient: 0 14px 48px rgba(17,24,39,.18);
  --shadow-hover-near: 0 6px 18px rgba(17,24,39,.12);
  --shadow-hover-ambient: 0 22px 64px rgba(17,24,39,.24);

  --trs: 260ms cubic-bezier(.22,.61,.36,1);
}

/* ============================ Mixins utilitaires ========================= */
@mixin glass-card($radius: 1rem, $blur: var(--glass-blur)) {
  position: relative;
  background:
    linear-gradient(180deg, color-mix(in srgb, var(--accent) 8%, transparent) 0%, transparent 80%),
    var(--glass-bg);
  backdrop-filter: blur($blur);
  -webkit-backdrop-filter: blur($blur);
  border: 1px solid var(--glass-border);
  border-radius: $radius;
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.50),
    var(--shadow-near),
    var(--shadow-ambient);
  transition:
    background-color var(--trs),
    border-color var(--trs),
    box-shadow var(--trs),
    transform var(--trs),
    backdrop-filter var(--trs), -webkit-backdrop-filter var(--trs);
  isolation: isolate;

  &::before {
    content: '';
    position: absolute; inset: 0;
    border-radius: inherit;
    box-shadow:
      inset 0 1px 0 rgba(255,255,255,.60),
      inset 0 -1px 0 rgba(17,24,39,.06);
    pointer-events: none;
  }
}

@mixin elevate-hover($dy: -1px) {
  transform: translateY($dy);
  box-shadow:
    inset 0 1px 0 rgba(255,255,255,.55),
    var(--shadow-hover-near),
    var(--shadow-hover-ambient);
}

/* ================================ Page Layout ============================ */
::ng-deep section {
  animation: pageIn .35s ease both;
}

@keyframes pageIn {
  from { opacity: 0; transform: translateY(6px); }
  to   { opacity: 1; transform: translateY(0); }
}

::ng-deep h1 {
  font-size: 1.5rem; font-weight: 800; letter-spacing: .2px;
  color: var(--ink);
  text-shadow:
    0 1px 0 rgba(255,255,255,.85),
    0 0 1px rgba(255,255,255,.6);
}

::ng-deep header a {
  color: var(--accent);
  font-weight: 600;
  &:hover { text-decoration: underline; }
}

/* ============================= Loading Skeleton ========================== */
::ng-deep .animate-pulse {
  @include glass-card(.875rem, var(--glass-blur-skeleton));
  padding: .75rem;
  color: var(--ink);
  will-change: transform, box-shadow;

  .bg-gray-200 {
    background: rgba(255,255,255,.35);
    border-radius: .5rem;
    animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
  }
}

@keyframes pulse {
  0%, 100% { opacity: 1; }
  50% { opacity: .5; }
}

/* ============================= Empty State Card ========================== */
::ng-deep .bg-white.rounded-xl.border {
  @include glass-card(1rem, var(--glass-blur-empty));
  padding: 1.5rem;
  color: var(--ink);
  will-change: transform, box-shadow;

  i {
    color: color-mix(in srgb, var(--muted) 50%, transparent);
  }

  p {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
  }

  a {
    color: var(--accent);
    font-weight: 600;
    &:hover { text-decoration: underline; }
  }
}

/* ============================== Product Cards ============================ */
::ng-deep .bg-white.rounded-lg.border {
  @include glass-card(.875rem, var(--glass-blur-card));
  padding: .75rem;
  color: var(--ink);
  will-change: transform, box-shadow;
  transition: all var(--trs);

  &:hover {
    @include elevate-hover(-1px);
  }

  img {
    border-radius: .5rem;
    box-shadow:
      0 1px 4px rgba(17,24,39,.10),
      inset 0 1px 0 rgba(255,255,255,.4);
    border: 1px solid rgba(255,255,255,.3);
  }

  h3 {
    color: var(--ink);
    font-weight: 600;
    text-shadow: 0 1px 0 rgba(255,255,255,.55);
    transition: color var(--trs);

    &:hover {
      color: var(--accent);
    }
  }

  .text-xs {
    color: color-mix(in srgb, var(--muted) 90%, var(--ink));
  }

  .text-sm {
    color: var(--ink);
  }

  button {
    @include glass-card(.5rem, 14px);
    background:
      linear-gradient(180deg, color-mix(in srgb, #ef4444 10%, transparent), transparent),
      rgba(255,255,255,.18);
    color: color-mix(in srgb, #dc2626 85%, #000);
    border-color: color-mix(in srgb, #ef4444 32%, var(--glass-border));
    padding: .25rem .5rem;
    font-size: .875rem;
    font-weight: 600;
    transition: all var(--trs);

    &:hover {
      background:
        linear-gradient(180deg, color-mix(in srgb, #ef4444 16%, transparent), transparent),
        rgba(255,255,255,.24);
      transform: translateY(-1px);
      box-shadow:
        inset 0 1px 0 rgba(255,255,255,.6),
        0 2px 6px rgba(239,68,68,.15);
    }
  }
}

/* =========================== "Voir plus" Link ============================ */
::ng-deep .mt-4.text-center a {
  color: var(--accent);
  font-weight: 600;
  transition: color var(--trs);

  &:hover {
    color: color-mix(in srgb, var(--accent) 80%, #000);
    text-decoration: underline;
  }
}

/* ============================== Responsive =============================== */
@media (prefers-reduced-motion: reduce) {
  :host * { transition: none !important; animation: none !important; }
}

/* =============== Fallback si backdrop-filter indisponible ================ */
@supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))) {
  ::ng-deep .bg-white.rounded-xl,
  ::ng-deep .bg-white.rounded-lg {
    background: rgba(255,255,255,.82);
  }
}
